<!-- templates/editar_perfil.html -->
{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center mt-5">
    <div class="col-md-8">
        <div class="card shadow-sm">
            <div class="card-header">
                <h2>Editar Mi Perfil</h2>
            </div>
            <div class="card-body">
                <form method="POST">
                    <!-- Campos existentes -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Nombre de Usuario:</label>
                            <input type="text" class="form-control" name="username" 
                                   value="{{ current_user.username }}" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Email:</label>
                            <input type="email" class="form-control" name="email" 
                                   value="{{ current_user.email }}" required>
                        </div>
                    </div>

                    <!-- NUEVO: TelÃ©fono -->
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label class="form-label">PaÃ­s:</label>
                            <select name="codigo_pais" class="form-select" id="codigo_pais">
                                {% set codigo_actual = current_user.telefono[:3] if current_user.telefono else '51' %}
                                <option value="51" {% if codigo_actual == '+51' %}selected{% endif %}>ðŸ‡µðŸ‡ª PerÃº (+51)</option>
                                <option value="1" {% if codigo_actual == '+1' %}selected{% endif %}>ðŸ‡ºðŸ‡¸ USA (+1)</option>
                                <option value="52" {% if codigo_actual == '+52' %}selected{% endif %}>ðŸ‡²ðŸ‡½ MÃ©xico (+52)</option>
                                <!-- MÃ¡s opciones... -->
                            </select>
                        </div>
                        <div class="col-md-8">
                            <label class="form-label">TelÃ©fono:</label>
                            {% set numero_actual = current_user.telefono[3:] if current_user.telefono else '' %}
                            <input type="tel" class="form-control" name="telefono" 
                                   value="{{ numero_actual }}" placeholder="987654321">
                        </div>
                    </div>

                    <!-- MÃ©todo de contacto preferido -->
                    <div class="mb-3">
                        <label class="form-label">MÃ©todo de Contacto Preferido:</label>
                        <select name="metodo_contacto" class="form-select">
                            <option value="email" {% if current_user.metodo_contacto_preferido == 'email' %}selected{% endif %}>Email</option>
                            <option value="sms" {% if current_user.metodo_contacto_preferido == 'sms' %}selected{% endif %}>SMS</option>
                        </select>
                    </div>

                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('main.dashboard') }}" class="btn btn-secondary">Cancelar</a>
                        <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
// Actualizar visualizaciÃ³n del telÃ©fono en tiempo real
document.addEventListener('DOMContentLoaded', function() {
    const codigoPais = document.getElementById('codigo_pais');
    const inputTelefono = document.querySelector('input[name="telefono"]');
    
    function actualizarEjemplo() {
        const ejemplo = document.getElementById('ejemplo-telefono');
        if (!ejemplo) {
            const divEjemplo = document.createElement('div');
            divEjemplo.id = 'ejemplo-telefono';
            divEjemplo.className = 'form-text';
            inputTelefono.parentNode.appendChild(divEjemplo);
        }
        document.getElementById('ejemplo-telefono').textContent = 
            `Ejemplo: +${codigoPais.value}${inputTelefono.value || '987654321'}`;
    }
    
    codigoPais.addEventListener('change', actualizarEjemplo);
    inputTelefono.addEventListener('input', actualizarEjemplo);
    actualizarEjemplo();
});
</script>
{% endblock %}